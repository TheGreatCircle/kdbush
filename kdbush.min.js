!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.KDBush=r()}(this,function(){"use strict";function t(o,n,e,i,s,h){if(!(s-i<=e)){var u=i+s>>1;!function t(o,n,e,i,s,h){for(;s>i;){if(s-i>600){var u=s-i+1,p=e-i+1,a=Math.log(u),f=.5*Math.exp(2*a/3),d=.5*Math.sqrt(a*f*(u-f)/u)*(p-u/2<0?-1:1),v=Math.max(i,Math.floor(e-p*f/u+d)),c=Math.min(s,Math.floor(e+(u-p)*f/u+d));t(o,n,e,v,c,h)}var l=n[2*e+h],g=i,y=s;for(r(o,n,i,e),n[2*s+h]>l&&r(o,n,i,s);g<y;){for(r(o,n,g,y),g++,y--;n[2*g+h]<l;)g++;for(;n[2*y+h]>l;)y--}n[2*i+h]===l?r(o,n,i,y):r(o,n,++y,s),y<=e&&(i=y+1),e<=y&&(s=y-1)}}(o,n,u,i,s,h),t(o,n,e,i,u-1,1-h),t(o,n,e,u+1,s,1-h)}}function r(t,r,n,e){o(t,n,e),o(r,2*n,2*e),o(r,2*n+1,2*e+1)}function o(t,r,o){var n=t[r];t[r]=t[o],t[o]=n}function n(t,r,o,n){var e=t-o,i=r-n;return e*e+i*i}var e=function(t){return t[0]},i=function(t){return t[1]},s=function(r,o){var n=o.getX;void 0===n&&(n=e);var s=o.getY;void 0===s&&(s=i);var h=o.nodeSize;void 0===h&&(h=64);var u=o.ArrayType;void 0===u&&(u=Float64Array);var p=o.ids,a=o.coords;this.nodeSize=64,this.points=Float64Array;var f=r.length<65536?Uint16Array:Uint32Array;if(p&&a)this.ids=p,this.coords=a;else{for(var d=this.ids=new f(r.length),v=this.coords=new u(2*r.length),c=0;c<r.length;c++)d[c]=c,v[2*c]=n(r[c]),v[2*c+1]=s(r[c]);t(d,v,h,0,d.length-1,0)}};return s.prototype.range=function(t,r,o,n){return function(t,r,o,n,e,i,s){for(var h=[0,t.length-1,0],u=[];h.length;){var p=h.pop(),a=h.pop(),f=h.pop();if(a-f<=s)for(var d=f;d<=a;d++){var v=r[2*d],c=r[2*d+1];v>=o&&v<=e&&c>=n&&c<=i&&u.push(t[d])}else{var l=f+a>>1,g=r[2*l],y=r[2*l+1];g>=o&&g<=e&&y>=n&&y<=i&&u.push(t[l]),(0===p?o<=g:n<=y)&&(h.push(f),h.push(l-1),h.push(1-p)),(0===p?e>=g:i>=y)&&(h.push(l+1),h.push(a),h.push(1-p))}}return u}(this.ids,this.coords,t,r,o,n,this.nodeSize)},s.prototype.within=function(t,r,o){return function(t,r,o,e,i,s){for(var h=[0,t.length-1,0],u=[],p=i*i;h.length;){var a=h.pop(),f=h.pop(),d=h.pop();if(f-d<=s)for(var v=d;v<=f;v++)n(r[2*v],r[2*v+1],o,e)<=p&&u.push(t[v]);else{var c=d+f>>1,l=r[2*c],g=r[2*c+1];n(l,g,o,e)<=p&&u.push(t[c]),(0===a?o-i<=l:e-i<=g)&&(h.push(d),h.push(c-1),h.push(1-a)),(0===a?o+i>=l:e+i>=g)&&(h.push(c+1),h.push(f),h.push(1-a))}}return u}(this.ids,this.coords,t,r,o,this.nodeSize)},s});

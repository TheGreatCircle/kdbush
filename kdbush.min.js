!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.KDBush=r()}(this,function(){"use strict";function t(o,n,i,e,s,h){if(!(s-e<=i)){var u=e+s>>1;!function t(o,n,i,e,s,h){for(;s>e;){if(s-e>600){var u=s-e+1,p=i-e+1,a=Math.log(u),f=.5*Math.exp(2*a/3),d=.5*Math.sqrt(a*f*(u-f)/u)*(p-u/2<0?-1:1),v=Math.max(e,Math.floor(i-p*f/u+d)),c=Math.min(s,Math.floor(i+(u-p)*f/u+d));t(o,n,i,v,c,h)}var l=n[2*i+h],g=e,y=s;for(r(o,n,e,i),n[2*s+h]>l&&r(o,n,e,s);g<y;){for(r(o,n,g,y),g++,y--;n[2*g+h]<l;)g++;for(;n[2*y+h]>l;)y--}n[2*e+h]===l?r(o,n,e,y):r(o,n,++y,s),y<=i&&(e=y+1),i<=y&&(s=y-1)}}(o,n,u,e,s,h),t(o,n,i,e,u-1,1-h),t(o,n,i,u+1,s,1-h)}}function r(t,r,n,i){o(t,n,i),o(r,2*n,2*i),o(r,2*n+1,2*i+1)}function o(t,r,o){var n=t[r];t[r]=t[o],t[o]=n}function n(t,r,o,n){var i=t-o,e=r-n;return i*i+e*e}var i=function(t){return t[0]},e=function(t){return t[1]},s=function(r,o){void 0===o&&(o={});var n=o.getX;void 0===n&&(n=i);var s=o.getY;void 0===s&&(s=e);var h=o.nodeSize;void 0===h&&(h=64);var u=o.ArrayType;void 0===u&&(u=Float64Array);var p=o.ids,a=o.coords;this.nodeSize=64,this.points=Float64Array;var f=r.length<65536?Uint16Array:Uint32Array;if(p&&a)this.ids=p,this.coords=a;else{for(var d=this.ids=new f(r.length),v=this.coords=new u(2*r.length),c=0;c<r.length;c++)d[c]=c,v[2*c]=n(r[c]),v[2*c+1]=s(r[c]);t(d,v,h,0,d.length-1,0)}};return s.prototype.range=function(t,r,o,n){return function(t,r,o,n,i,e,s){for(var h=[0,t.length-1,0],u=[];h.length;){var p=h.pop(),a=h.pop(),f=h.pop();if(a-f<=s)for(var d=f;d<=a;d++){var v=r[2*d],c=r[2*d+1];v>=o&&v<=i&&c>=n&&c<=e&&u.push(t[d])}else{var l=f+a>>1,g=r[2*l],y=r[2*l+1];g>=o&&g<=i&&y>=n&&y<=e&&u.push(t[l]),(0===p?o<=g:n<=y)&&(h.push(f),h.push(l-1),h.push(1-p)),(0===p?i>=g:e>=y)&&(h.push(l+1),h.push(a),h.push(1-p))}}return u}(this.ids,this.coords,t,r,o,n,this.nodeSize)},s.prototype.within=function(t,r,o){return function(t,r,o,i,e,s){for(var h=[0,t.length-1,0],u=[],p=e*e;h.length;){var a=h.pop(),f=h.pop(),d=h.pop();if(f-d<=s)for(var v=d;v<=f;v++)n(r[2*v],r[2*v+1],o,i)<=p&&u.push(t[v]);else{var c=d+f>>1,l=r[2*c],g=r[2*c+1];n(l,g,o,i)<=p&&u.push(t[c]),(0===a?o-e<=l:i-e<=g)&&(h.push(d),h.push(c-1),h.push(1-a)),(0===a?o+e>=l:i+e>=g)&&(h.push(c+1),h.push(f),h.push(1-a))}}return u}(this.ids,this.coords,t,r,o,this.nodeSize)},s});
